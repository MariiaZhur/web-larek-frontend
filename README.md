# Проектная работа "WEB-ларёк"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/mixins/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


# Архитектура проекта "WEB-ларёк"

Данный документ описывает архитектуру клиентской части интернет-магазина "WEB-ларёк".  
Архитектура построена по паттерну **MVP (Model–View–Presenter)**.  
- Model (Модель) — отвечает за бизнес-логику, данные и работу с API.
В проекте это модули вроде api.ts, интерфейсы (IProduct, IOrder, и т.д.), которые описывают структуру данных и взаимодействие с сервером.
- View (Представление) — пользовательский интерфейс, не содержит логики.
Это HTML-разметка и компоненты, которые отображают данные, но не обрабатывают их.
- Presenter (Презентер) — посредник между Model и View, управляет логикой отображения.

Взаимодействие между слоями реализовано через **событийно-ориентированный подход** с использованием `EventEmitter`.

---

## Основные типы/интерфейсы

- `IProduct` — интерфейс со всеми свойствами продукта
- `IBasket` — интерфейс корзины с её содержимым и общей стоимостью
- `IOrder` — интерфейс итогового заказа для отправки на сервер
- `ISubmissionOrderResult` — интерфейс результата отправки заказа от API
- `IEvents` — интерфейс событийного брокера (EventEmitter)
- `UUID` — тип уникального идентификатора (строка)
- `Price` — тип значения цены товара
- `Url` — тип строки с адресом изображения
- `PhoneNumber` — тип строки с номером телефона
- `Email` — тип строки с email
- `PaymentMethod` — перечисление доступных способов оплаты (`"online"` или `"cash"`)


## Список событий и их назначение

### События `product:*`

| Событие                | Payload      | Описание события                              |
|------------------------|--------------|-----------------------------------------------|
| `product:showDetails`  | `IProduct`   | Показать информацию о товаре в модальном окне |

### События `basket:*`

| Событие                | Payload    | Описание события                  |
|------------------------|------------|-----------------------------------|
| `basket:addProduct`    | `IProduct` | Добавить товар в корзину          |
| `basket:removeProduct` | `IProduct` | Удалить товар из корзины          |
| `basket:show`          | —          | Показать корзину в модальном окне |
| `basket:refreshView`   | —          | Обновить отображение Корзины      |

### События `order:*`

| Событие                      | Payload                  | Описание события                                     |
|------------------------------|--------------------------|------------------------------------------------------|
| `order:show`                 | —                        | Открыть первый шаг оформления заказа                 |
| `order:submit`               | `IOrder`                 | Отправить заказ на сервер                            |
| `order:showSubmissionResult` | `ISubmissionOrderResult` | Показать результат отправки заказа: успех или ошибка |


## Описание ключевых классов

### Класс `Api` — реализация клиентского API

Класс отвечает за отправку запросов к серверу и обработку ответов. Используется для взаимодействия с серверной частью приложения. Наследуется от класса `Api`.

**Конструктор:**
- `constructor(baseUrl: string, options: RequestInit = {})` — принимает базовый адрес сервера (`baseUrl`) и объект `options`, содержащий заголовки и другие опции запросов.

**Поля:**
- `baseUrl: string` — основной адрес, по которому выполняются все HTTP-запросы.
- `options: RequestInit` — настройки, передаваемые каждому запросу (например, заголовки, метод и т.д.).

**Методы:**
- `handleResponse(response: Response): Promise<object>` — защищённый метод, обрабатывающий ответ от сервера. Возвращает объект данных или бросает ошибку при неудачном ответе.
- `get(uri: string): Promise<object>` — выполняет GET-запрос на указанный путь. Возвращает результат запроса в формате JSON.
- `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` — отправляет данные на сервер по заданному адресу и с указанным методом (`POST`, `PUT` или `DELETE`).

---

### Класс `EventEmitter` — реализация интерфейса `IEvents`

Событийный брокер, реализующий шаблон «Наблюдатель». Предоставляет механизм подписки, отписки и создания событий. Поддерживает подписку на конкретные события или на все сразу.

**Типы:**
- `EventTrigger<T>` — функция-триггер: `(data: T) => void`
- `EventSubscription<T>` — функция подписки: `(callback: (data: T) => void) => void`

**Интерфейс `IEvents`:**
- `on(event: EventName, callback: (data) => void): void` — подписка на событие.
- `off(event: EventName, callback: Function): void` — отписка от события.
- `onAll(callback: (event: { eventName: string, data: unknown }) => void): void` — подписка на все события.
- `offAll(): void` — отписка от всех событий.
- `createTrigger(event: string): EventTrigger<T>` — создаёт функцию-триггер.
- `createSubscription(event: EventName): EventSubscription<T>` — создаёт подписку на событие.

**Класс `EventEmitter`:**
- `private _events: Map<EventName, Set<Subscriber>>` — внутреннее хранилище обработчиков.
- `constructor()` — инициализирует пустой набор событий.
- `on()` / `off()` — подписка и отписка от событий.
- `onAll()` / `offAll()` — универсальная подписка/отписка на всё.
- `createTrigger()` — основной способ инициировать событие извне.
- `createSubscription()` — предоставляет подписчику доступ к событиям через callback.

**Особенности:**
- Поддерживает события по строке и по RegExp.
- Методы `emit()` и `trigger()` скрыты из публичного API: внешние модули используют `createTrigger()`.

---

### Класс `EventsLogger` — отладочный помощник

Простой, но полезный инструмент, который выводит все события в консоль. Помогает разработчику понять, что, где и когда сработало.

**Методы:**
- `log(eventName: string, data?: unknown): void` — пишет в консоль сообщение вида `[EventLogger] Event: "имя события"`, а также переданные данные.

---

### Класс `Application` — точка входа и главный оркестратор

Связывает все слои приложения: модели, представления, события и API. Выполняет инициализацию, настраивает связи и запускает работу интерфейса.

**Поля:**
- `eventEmitter: EventEmitter` — центральная шина событий.
- `api: Api` — клиент для общения с сервером.
- `logger: EventsLogger` — выводит все события в консоль (через `onAll`).
- `productsPath: Url` — путь к API-эндпойнту для получения товаров.
- `orderPath: Url` — путь к API-эндпойнту для отправки заказа.
- `basket: IBasket` — модель корзины.
- `submissionOrderResultEventTrigger: SubmissionOrderResultShowEventTrigger` — триггер для отображения результата заказа.

**Методы:**
- `constructor()` — инициализирует EventEmitter, API, логгер, загружает каталог и компоненты. Подписывает логгер на все события.
- (остальные методы инициализации компонентов, загрузки данных и подписки описываются в теле конструктора — каждый шаг подключает новые View и связывает их с логикой через события).

**Особенности:**
- Вся логика взаимодействия между пользователем и приложением завязана на события.
- Каталог товаров загружается асинхронно и после получения отображается на странице.
- Компоненты `BasketView`, `ModalForm`, `OrderView`, `SubmissionOrderResultView` связываются через EventEmitter.
- Используется строгая типизация и централизованная маршрутизация событий.

---

### Класс `ModalForm`

Отвечает за управление модальным окном: отображение, закрытие, замена содержимого и обработка кликов.

**Конструктор:**
- `constructor()` — инициализирует контейнер `#modal-container`, находит `.modal__content` и кнопку `.modal__close`

**Методы:**
- `setContent(content: HTMLElement): void` — заменяет содержимое модального окна перед показом
- `open(): void` — открывает модалку, блокирует прокрутку страницы, вешает обработчик на Escape
- `close(): void` — закрывает окно, очищает контент, возвращает прокрутку, снимает слушатели

**Особенности:**
- Закрытие по клику вне контента
- Закрытие по нажатию Escape

---

## Описание классов Model, которые позволяют хранить и обрабатывать данные с сервера и от пользователей.

### Класс `ProductModel` — реализация интерфейса `IProduct`

Класс предназначен для хранения и представления информации о товаре. Используется в карточках товаров, корзине и модальных окнах.

**Конструктор:**
- `constructor(id: UUID, title: string, description: string, price: Price, image: Url, categories: string[])` — принимает значения всех свойств товара и сохраняет их во внутренние поля.

**Поля:**
- `id: UUID` — уникальный идентификатор товара.
- `title: string` — название товара.
- `description: string` — подробное описание товара.
- `price: Price` — цена товара. Может быть `null`, если товар бесплатный.
- `image: Url` — ссылка на изображение товара.
- `categories: string[]` — список категорий, к которым принадлежит товар.

---

### Класс `BasketModel` — реализация интерфейса `IBasket`

Модель корзины пользователя, отвечающая за хранение добавленных товаров, вычисление общей суммы и оповещение представления об изменениях. Используется как глобальное хранилище корзины на клиенте.

**Конструктор:**
- `constructor(basketRefreshViewEventTrigger: BasketRefreshViewEventTrigger)` — принимает триггер обновления представления корзины. Этот колбэк вызывается после любого изменения состава корзины.

**Поля:**
- `products: IProduct[]` — массив товаров, добавленных в корзину.
- `total: Price` — общая стоимость товаров в корзине.

**Методы:**
- `addProduct(product: IProduct): void` — добавляет товар, если он ещё не был добавлен; вызывает обновление представления.
- `removeProduct(product: IProduct): void` — удаляет товар по его идентификатору; инициирует обновление.
- `clear(): void` — очищает корзину и сбрасывает общую сумму.
- `getCount(): number` — возвращает количество товаров в корзине.

---

### Класс `OrderModel` — реализация интерфейса `IOrder`

Модель финального заказа, объединяющая данные корзины, клиента и способа доставки. Используется для формирования объекта, отправляемого на сервер.

**Конструктор:**
- `constructor(basket: IBasket, shippingAndPaymentInfo: IShippingAndPaymentInfo, customerInfo: ICustomerInfo)` — принимает корзину, данные доставки и контактную информацию клиента.

**Поля:**
- `payment: PaymentMethod` — выбранный способ оплаты.
- `email: string` — email покупателя (из `customerInfo`).
- `phone: string` — телефон покупателя (из `customerInfo`).
- `address: string` — адрес доставки.
- `total: number` — общая сумма заказа (из корзины).
- `items: string[]` — массив идентификаторов товаров, исключая те, у которых цена `0` или не задана.

**Особенности:**
- При формировании массива `items` отфильтровываются товары с нулевой ценой (`price <= 0` или `null`). Это предотвращает отправку «бесплатных» позиций в заказ.

---

### Класс `CustomerInfoModel` — реализация интерфейса `ICustomerInfo`

Содержит и валидирует контактные данные покупателя. Используется при оформлении заказа для передачи email и номера телефона на сервер.

**Конструктор:**
- `constructor(email: Email = '', phone: PhoneNumber = '')` — принимает email и номер телефона, по умолчанию создаёт пустые значения.

**Поля:**
- `email: Email` — адрес электронной почты покупателя.
- `phone: PhoneNumber` — номер телефона покупателя.

**Методы:**
- `isValid(): boolean` — возвращает `true`, если и email, и телефон заполнены.
- `getValidationError(): string \| null` — возвращает текст ошибки, если какое-либо поле не заполнено. Возможные значения: `'Не введён email.'`, `'Не введён телефон.'`; если всё корректно — `null`.

---

### Класс `ShippingAndPaymentInfoModel` — реализация интерфейса `IShippingAndPaymentInfo`

Хранит и валидирует информацию о доставке и способе оплаты. Используется при оформлении заказа и передаётся в `OrderModel`.

**Конструктор:**
- `constructor(address: string = '', paymentMethod: PaymentMethod \| null = null)` — принимает адрес и способ оплаты; по умолчанию поля пустые.

**Поля:**
- `address: string` — адрес доставки.
- `paymentMethod: PaymentMethod \| null` — способ оплаты: `"online"` или `"cash"`.

**Методы:**
- `isValid(): boolean` — возвращает `true`, если адрес введён и способ оплаты выбран.
- `getValidationError(): string \| null` — возвращает сообщение об ошибке, если не выбран способ оплаты или не указан адрес. Возможные значения: `'Не выбран способ оплаты.'`, `'Не введён адрес.'`.

---

### Класс `SubmitOrderResultModel` — реализация интерфейса `ISubmissionOrderResult`

Простая модель, представляющая результат оформления заказа, полученного от API. Используется как структура данных для отображения результата пользователю.

**Поля:**
- `id: UUID` — номер созданного заказа.
- `total: Price` — сумма, списанная за заказ.

---

## Классы представления (View)

Классы этого слоя отображают данные, полученные из модели, и предоставляют интерфейс для взаимодействия с пользователем. Каждый класс работает с конкретным интерфейсом данных (например, `IProduct`, `IBasket`, и т.д.) и DOM-элементом, в который эти данные отображаются.

### Класс `CatalogView`

Отвечает за отображение списка товаров на главной странице. Для каждого товара создаёт отдельный `ProductView`.

**Конструктор:**
- `constructor(parentContainer: HTMLElement, products: IProduct[], showProductDetailsEventTrigger: ProductShowDetailsEventTrigger)`
  - `parentContainer` — DOM-элемент, куда вставляются карточки
  - `products` — массив товаров, полученных от API
  - `showProductDetailsEventTrigger` — триггер показа деталей товара

**Функциональность:**
- Создаёт `ProductView` для каждого товара и сохраняет их в `productViews[]`
- Вставляет карточки в указанный контейнер
- Передаёт в каждую карточку триггер показа подробной информации о товаре

--- 

### Класс `ProductView`

Отвечает за создание и отображение одной карточки товара на главной странице.

**Конструктор:**
- `constructor(parentElement: HTMLElement, product: IProduct, showProductDetailsEventTrigger: ProductShowDetailsEventTrigger)`
  - `parentElement` — контейнер, куда будет вставлена карточка
  - `product` — объект с данными товара
  - `showProductDetailsEventTrigger` — триггер открытия подробностей товара

**Функциональность:**
- Создаёт DOM-элемент карточки из шаблона `#card-catalog`
- Заполняет заголовок, категорию, изображение и цену
- При клике на карточку вызывает `product:showDetails` с данным товаром

---

### Класс `ProductDetailesView`

Отвечает за отображение карточки товара с подробностями в модальном окне.

**Конструктор:**
- `constructor(modal: ModalForm, showProductDetailsEventSubscription: ProductShowDetailsEventSubscription, addProductToBusketEventTrigger: ProductAddToBusketEventTrigger)`
  - `modal` — модальное окно
  - `showProductDetailsEventSubscription` — подписка на `product:showDetails`
  - `addProductToBusketEventTrigger` — триггер на добавление товара в корзину

**Функциональность:**
- Подписывается на `product:showDetails` и отображает карточку товара из шаблона `#card-preview`
- Заполняет изображение, заголовок, категорию, описание, цену
- Добавляет кнопку "В корзину", которая при нажатии:
  - вызывает триггер добавления товара в корзину
  - закрывает модалку

---

### Класс `BasketHeaderView`

Отвечает за отображение и обновление кнопки корзины в шапке сайта.

**Конструктор:**
- `constructor(basket: IBasket, basketShowEventTrigger: BasketShowEventTrigger)` — принимает модель корзины и триггер для её показа.

**Функциональность:**
- Находит кнопку `.header__basket` и вложенный в неё счётчик `.header__basket-counter`.
- Отображает текущее количество товаров при инициализации.
- При клике на кнопку вызывает событие `basketShowEventTrigger`.
- Метод `refreshCounter(basket: IBasket)` — обновляет отображаемое количество товаров.

---

### Класс `BasketView` — презентер корзины в модальном окне

Отвечает за отображение полной корзины в модалке, управление её содержимым и переход к оформлению заказа.

**Конструктор:**
- `constructor(basket: IBasket, modal: ModalForm, basketShowEventSubscription: BasketShowEventSubscription, orderShowEventTrigger: OrderShowEventTrigger)`
  - `basket` — модель корзины
  - `modal` — модальное окно
  - `basketShowEventSubscription` — подписка на `basket:show`
  - `orderShowEventTrigger` — триггер показа формы заказа

**Функциональность:**
- При подписке на событие `basket:show` отрисовывает шаблон корзины (`#basket`) с товарами (`#card-basket`)
- Заполняет название, цену и индекс каждого товара
- Позволяет удалить товар по кнопке `.basket__item-delete`
- Отображает итоговую сумму (`.basket__price`)
- При нажатии на кнопку "Оформить заказ" триггерит `order:show`

---

### Класс `OrderView`

Отвечает за отображение формы оформления заказа. Работает в два шага: сначала адрес и оплата, затем контакты. Результатом становится событие `order:submit`.

**Конструктор:**
- `constructor(modalForm: ModalForm, orderShowEventSubscription: OrderShowEventSubscription, orderSubmitEventTrigger: OrderSubmitEventTrigger)`
  - `modalForm` — модальное окно
  - `orderShowEventSubscription` — подписка на `order:show`
  - `orderSubmitEventTrigger` — триггер на `order:submit`

**Функциональность:**
- Подписывается на `order:show` и открывает форму заказа
- Шаг 1: запрашивает адрес и способ оплаты (card / cash)
- Шаг 2: запрашивает email и телефон
- Использует `ShippingAndPaymentInfoModel` и `CustomerInfoModel` для хранения данных
- Выполняет валидацию полей на каждом шаге
- После подтверждения формирует `OrderModel` и триггерит отправку заказа

---

### Класс `SubmissionOrderResultView`

Отвечает за отображение результата успешно оформленного заказа в модальном окне.

**Конструктор:**
- `constructor(modalForm: ModalForm, submissionOrderResultEventSubscription: SubmissionOrderResultShowEventSubscription)`
  - `modalForm` — модальное окно
  - `submissionOrderResultEventSubscription` — подписка на `order:showSubmissionResult`

**Функциональность:**
- Подписывается на событие `order:showSubmissionResult`
- Отображает шаблон `#success` с итоговой суммой заказа
- Устанавливает обработчик на кнопку закрытия `.order-success__close`
- Вставляет содержимое в модалку и открывает окно
