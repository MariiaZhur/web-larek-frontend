# Проектная работа "WEB-ларёк"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/mixins/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


# Архитектура проекта "WEB-ларёк"

Данный документ описывает архитектуру клиентской части интернет-магазина "WEB-ларёк".  
Архитектура построена по паттерну **MVP (Model–View–Presenter)**.  
- Model (Модель) — отвечает за бизнес-логику, данные и работу с API.
В проекте это модули вроде api.ts, интерфейсы (IProduct, IOrder, и т.д.), которые описывают структуру данных и взаимодействие с сервером.
- View (Представление) — пользовательский интерфейс, не содержит логики.
Это HTML-разметка и компоненты, которые отображают данные, но не обрабатывают их.
- Presenter (Презентер) — посредник между Model и View, управляет логикой отображения.

Взаимодействие между слоями реализовано через **событийно-ориентированный подход** с использованием `EventEmitter`.

---

## Основные типы/интерфейсы

- `IProduct` — интерфейс со всеми свойствами продукта
- `IBasket` — интерфейс корзины с её содержимым и общей стоимостью
- `IOrder` — интерфейс итогового заказа для отправки на сервер
- `ISubmissionOrderResult` — интерфейс результата отправки заказа от API
- `IEvents` — интерфейс событийного брокера (EventEmitter)
- `UUID` — тип уникального идентификатора (строка)
- `Price` — тип значения цены товара
- `Url` — тип строки с адресом изображения
- `PhoneNumber` — тип строки с номером телефона
- `Email` — тип строки с email
- `PaymentMethod` — перечисление доступных способов оплаты (`"card"` или `"cash"`)


## Список событий и их назначение

### События `product:*`

| Событие                | Payload      | Описание события                              |
|------------------------|--------------|-----------------------------------------------|
| `product:showDetails`  | `IProduct`   | Показать информацию о товаре в модальном окне |

### События `basket:*`

| Событие                | Payload    | Описание события                  |
|------------------------|------------|-----------------------------------|
| `basket:addProduct`    | `IProduct` | Добавить товар в корзину          |
| `basket:removeProduct` | `IProduct` | Удалить товар из корзины          |
| `basket:show`          | —          | Показать корзину в модальном окне |
| `basket:refreshView`   | —          | Обновить отображение Корзины      |

### События `order:*`

| Событие                      | Payload                  | Описание события                                     |
|------------------------------|--------------------------|------------------------------------------------------|
| `order:show`                 | —                        | Открыть первый шаг оформления заказа                 |
| `order:submit`               | `IOrder`                 | Отправить заказ на сервер                            |
| `order:showSubmissionResult` | `ISubmissionOrderResult` | Показать результат отправки заказа: успех или ошибка |


## Описание ключевых классов

### Класс `Api` — реализация клиентского API

Класс отвечает за отправку запросов к серверу и обработку ответов. Используется для взаимодействия с серверной частью приложения. Наследуется от класса `Api`.

**Конструктор:**
- `constructor(baseUrl: string, options: RequestInit = {})` — принимает базовый адрес сервера (`baseUrl`) и объект `options`, содержащий заголовки и другие опции запросов.

**Поля:**
- `baseUrl: string` — основной адрес, по которому выполняются все HTTP-запросы.
- `options: RequestInit` — настройки, передаваемые каждому запросу (например, заголовки, метод и т.д.).

**Методы:**
- `handleResponse(response: Response): Promise<object>` — защищённый метод, обрабатывающий ответ от сервера. Возвращает объект данных или бросает ошибку при неудачном ответе.
- `get(uri: string): Promise<object>` — выполняет GET-запрос на указанный путь. Возвращает результат запроса в формате JSON.
- `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` — отправляет данные на сервер по заданному адресу и с указанным методом (`POST`, `PUT` или `DELETE`).

---

### Класс `EventEmitter` — брокер событий, реализующий шаблон «Наблюдатель»

Класс обеспечивает событийное взаимодействие между частями приложения. Позволяет подписываться на события, удалять подписки и инициировать события. Реализует интерфейс `IEvents`.

**Конструктор:**
- `constructor()` — создаёт новый экземпляр брокера событий с пустыми списками слушателей.

**Методы:**
- `on(event: string, handler: Function): void` — подписывает обработчик `handler` на событие `event`.
- `off(event: string, handler: Function): void` — удаляет обработчик `handler` с события `event`.
- `emit(event: string, data?: any): void` — вызывает все подписчики события `event`, передавая им данные.
- `onAll(handler: Function): void` — подписывает обработчик на все события.
- `offAll(): void` — удаляет всех подписчиков на все события.
- `trigger(event: string, ...args: any[]): void` — вручную запускает событие с аргументами. Может быть передан как универсальный обработчик в другие классы, позволяя инициировать события без зависимости от `EventEmitter`.

---

### Класс `Application` — главный контроллер и связующее звено между слоями Model и View

Класс `Application` реализует паттерн Presenter и управляет всей логикой приложения: инициализирует модели и представления, подписывается на события от пользователя, реагирует на изменения в данных, обрабатывает взаимодействие с API и управляет отображением.

**Конструктор:**
- `constructor()` — создаёт экземпляры всех моделей, представлений и сервисов, подписывается на события и запускает отображение главной страницы.

**Поля:**
- `api: Api` — клиент для работы с сервером, реализующий методы получения и отправки данных.
- `eventEmitter: EventEmitter` — брокер событий, используемый для связи между слоями.
- `catalogView: CatalogView` — компонент отображения каталога товаров.
- `basketModel: BasketModel` — модель корзины пользователя.
- `basketView: BasketView` — иконка корзины с количеством товаров.
- `basketDetailsView: BasketDetailsView` — отображение полной корзины с товарами.
- `orderView: OrderView` — форма оформления заказа.
- `submitOrderResultView: SubmissionOrderResultView` — сообщение об успешной отправке заказа.
- `modalForm: ModalForm` — универсальный модальный контейнер.
- `products: IProduct[]` — список товаров, полученных с сервера.

**Методы:**
- `init(): void` — главная точка входа в приложение: загружает каталог, рендерит товары, активирует подписки на события.
- `handleSubmitOrder(order: IOrder): void` — отправляет заказ на сервер через API, очищает корзину и отправляет событие с результатом.
`

## Описание классов Model, которые позволяют хранить и обрабатывать данные с сервера и от пользователей.

### Класс `ProductModel` — реализация интерфейса `IProduct`

Класс предназначен для хранения и представления информации о товаре. Используется в карточках товаров, корзине и модальных окнах.

**Конструктор:**
- `constructor(id: UUID, title: string, description: string, price: Price, image: Url, categories: string[])` — принимает значения всех свойств товара и сохраняет их во внутренние поля.

**Поля:**
- `id: UUID` — уникальный идентификатор товара.
- `title: string` — название товара.
- `description: string` — подробное описание товара.
- `price: Price` — цена товара. Может быть `null`, если товар бесплатный.
- `image: Url` — ссылка на изображение товара.
- `categories: string[]` — список категорий, к которым принадлежит товар.

---

### Класс `BasketModel` — реализация интерфейса `IBasket`

Глобальный синглтон для хранения информации о состоянии корзины пользователя: хранит товары, позволяет добавлять, удалять и очищать список покупок, а также рассчитывает итоговую сумму и количество позиций.

**Конструктор:**
- `constructor()` — создаёт пустую корзину, инициализируя список товаров как пустой массив.

**Поля:**
- `products: IProduct[]` — массив товаров, которые пользователь положил в корзину.

**Методы:**
- `addProduct(product: IProduct): void` — добавляет товар в корзину, если его там ещё нет. Подписан на событие `basket:addProduct`.
- `removeProduct(product: IProduct): void` — удаляет товар из Корзины. Подписан на событие `basket:removeProduct`.
- `clear(): void` — очищает корзину полностью. Используется, например, после успешной оплаты. 
- `getTotal(): Price` — рассчитывает общую стоимость всех товаров в корзине.
- `getCount(): number` — возвращает общее количество товаров в корзине.
- `getProducts(): IProduct[]` — возвращает текущий массив товаров в корзине.
---

### Класс `OrderModel` — реализация интерфейса `IOrder`

Модель заказа, объединяющая информацию о доставке, клиенте, товарах и финальной сумме. Используется для формирования запроса на оформление заказа.

**Конструктор:**
- `constructor(delivery: IShippingAndPaymentInfo, customer: ICustomerInfo, items: UUID[], total: Price)` — принимает все данные, составляющие заказ, и сохраняет их в соответствующие поля.

**Поля:**
- `delivery: IShippingAndPaymentInfo` — объект с адресом доставки и способом оплаты.
- `customer: ICustomerInfo` — объект с контактной информацией покупателя.
- `items: UUID[]` — массив идентификаторов товаров, включённых в заказ.
- `total: Price` — общая сумма, подлежащая оплате.

---

### Класс `CustomerInfoModel` — реализация интерфейса `ICustomerInfo`

Содержит контактные данные покупателя.

**Конструктор:**
- `constructor(email: Email, phone: PhoneNumber)` — принимает email и номер телефона и сохраняет их.

**Поля:**
- `email: Email` — почта клиента.
- `phone: PhoneNumber` — телефон клиента.

---

### Класс `ShippingAndPaymentInfoModel` — реализация интерфейса `IShippingAndPaymentInfo`

Класс предназначен для хранения информации о доставке.

**Конструктор:**
- `constructor(address: string, payment: PaymentMethod)` — принимает адрес и способ оплаты и сохраняет их.

**Поля:**
- `address: string` — адрес, по которому необходимо выполнить доставку.
- `payment: PaymentMethod` — способ оплаты (наличные или карта).

---

### Класс `SubmissionOrderResultModel` — реализация интерфейса `ISubmissionOrderResult`

Отвечает за представление результата оформления заказа, полученного от сервера.

**Конструктор:**
- `constructor(id: UUID, total: Price, message: string)` — принимает данные результата оформления заказа.

**Поля:**
- `id: UUID` — номер созданного заказа.
- `total: Price` — сумма, списанная за заказ.
- `message: string` — текстовое подтверждение успешного оформления или ошибка обработки заказа.


## Классы представления (View)

Классы этого слоя отображают данные, полученные из модели, и предоставляют интерфейс для взаимодействия с пользователем. Каждый класс работает с конкретным интерфейсом данных (например, `IProduct`, `IBasket`, и т.д.) и DOM-элементом, в который эти данные отображаются.

### Класс `CatalogView`

Управляет отображением страницы с товарами. Отвечает за визуализацию каталога товаров.

**Конструктор:**
- `constructor(products: IProduct[], showDetails: EventTrigger<IProduct>)` — принимает массив товаров и триггер сообщения для открытия модального окна с детальным описание товара.

**Поля:**
- `products: IProduct[]` — массив товаров для отображения.
- `element: HTMLElement` — контейнер содержащий каталог товаров.
- `producViews: ProductView[]` — массив представлений товаров.

--- 

### Класс `ProductView` 

Отображает карточку товара на главной странице. Клик по карточке генерирует событие `product:showDetails`

**Конструктор:**
- `constructor( product: IProduct, showDetails: EventTrigger<IProduct>)` — принимает данные товара и триггер сообщения для открытия модального окна с детальным описание товара.

**Поля:**
- `element: HTMLElement` — DOM-элемент карточки.
- `product: IProduct` — данные для отображения.

---

### Класс `ProductDetailedView` 

Наследуется от `ProductView`. Отображает карточку товара в модальном окне с возможностью добавления в корзину. Клик по кнопке `Добавить в Корзину` высылает событие `basket:addProduct`.

**Конструктор:**
- `constructor(product: IProduct, addToBusket: EventTrigger<IProduct>)` — принимает данные товара и триггер сообщения для добавления в корзину.

**Поля:**
- `element: HTMLElement` — контейнер карточки.
- `product: IProduct` — данные товара.

---

### Класс `BasketView` 
Отвечает за отображение иконки Корзины и количества добавленных товаров

**Конструктор:**
- `constructor(basket: IBasket, refreshBasketView: EventSubscription<void>)` — принимает объект корзины и подписчик на сообщения для обновления отображения корзины.

**Поля:**
- `element: HTMLElement` — контейнер с иконкой и количество товаров.
- `basket: IBasket` — Модель корзины.

**Методы:**
- `refreshView()` — обновляет отображение корзины.

---

### Класс `BasketDetailsView` 

Отвечает за отображение корзины: список товаров, общее количество и сумма заказа.

**Конструктор:**
- `constructor(basket: IBasket, removeFromBasket: EventTrigger<IProduct>)` — принимает объект корзины и триггер сообщения для удаления товара из корзины

**Поля:**
- `element: HTMLElement` — контейнер с корзиной.
- `basket: IBasket` — Модель Корзины.
- `basketItems: BasketItemView[]` — массив представлений товаров в корзине.`

---

### Класс `BasketItemView`

Отвечает за отображение конкретного товара в Корзине. При клике на иконку мусорка генерирует событие `basket:removeProduct`.

**Конструктор:**
- `constructor(product: IProduct, removeFromBasket: EventTrigger<IProduct>)` — принимает данные товара и триггер сообщения для удаления товара из корзины

**Поля:**
- `element: HTMLElement` — контейнер с корзиной.
- `product: IProduct` — данные товара.`

---

### Класс `OrderView` 

Отображает форму ввода адреса и выбора способа оплаты.

**Конструктор:**
- `constructor(basket: IBasket, submitOrder: EventTrigger<IOrder>, showrOderSubmissionResult: EventSubscription<ISubmissionOrderResult>)` — принимает объект корзины, триггер сообщения для отправки заказа и подписчик события для отображения результата отправки заказа.

**Поля:**
- `element: HTMLElement` — DOM-объект формы заказа.
- `basket: IBasket` — Модель корзины.
- `shippingAndPaymentInfo: IShippingAndPaymentInfo` — данные о доставке.
- `customerInfo: ICustomerInfo` — данные клиента.
- `order: IOrder` — модель заказа

---

### Класс `ModalForm` 

Универсальный контейнер для отображения модальных окон.

**Конструктор:**
- `constructor(container: HTMLElement)` — принимает контейнер модального окна (обычно `#modal-container`).

**Поля:**
- `container: HTMLElement` — элемент, в котором отображается содержимое.

**Методы:**
- `open(content: HTMLElement): void` — отображает окно с переданным содержимым.
- `close(): void` — закрывает и очищает окно.

---
